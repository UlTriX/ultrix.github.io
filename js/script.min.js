/*
 PT-City-Brand-Ranking-2015 2017-04-05 
*/
var width=960,height=1160;d3.json("topo_json/pt.json",function(a,b){var c=["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],d=[0,.12,.24,.36,.48,.6,.72,.84,1],e=d3.scale.linear().domain(d).range(c),f=d3.geo.albers().center([-5.5,40]).rotate([4.4,0]).parallels([50,60]).scale(7e3),g=d3.geo.path().projection(f),h=d3.select("body").append("svg").attr("width",width).attr("height",height),i=topojson.feature(b,b.objects.subunits);h.append("path").datum(i).attr("d",g);var j=d3.select("body").append("div").attr("class","tooltip tooltip-inner tooltip.top").style("visibility","hidden");h.selectAll(".subunit").data(i.features).enter().append("g").attr("transform",function(a){return"Região Autónoma dos Açores"===a.properties.name?"translate(950,150) scale(0.6)":"Região Autónoma da Madeira"===a.properties.name?"translate(700,-300) scale(1)":void 0}).append("path").style("fill",function(a){var b=(a.properties.name,Math.random());return e(b)}).on("mouseover",function(a){d3.select(this).style("fill-opacity","1"),j.html("<b>a</b><br>"),j.style("visibility","visible");var b=getRanking(a.properties.name);$("#infobox").html("<b>"+a.properties.name+"</b><br><p>Posição Global:"+b.posicao+"</p>")}).on("mousemove",function(){return j.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px")}).on("mouseout",function(){return d3.select(this).style("fill-opacity","0.92"),j.style("visibility","hidden")}).attr("d",g).style("stroke","white").style("stroke-width","1").style("fill-opacity","0.92");var k=h.selectAll(".legend").data(e.ticks(9).reverse()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate("+(width-80+20)+","+(150+20*b)+")"});k.append("rect").attr("width",20).attr("height",20).style("fill",e),k.append("text").attr("x",26).attr("y",10).attr("dy",".35em").text(function(a){return 100*a+"%"})});var getRanking=function(a){return ranking[a.toLowerCase()]},ranking={lisboa:{posicao:1,negocios:1,visitar:1,viver:1},porto:{posicao:2,negocios:1,visitar:3,viver:4},braga:{posicao:3,negocios:3,visitar:20,viver:7},oeiras:{posicao:4,negocios:4,visitar:17,viver:9},coimbra:{posicao:5,negocios:7,visitar:14,viver:3},aveiro:{posicao:6,negocios:6,visitar:16,viver:12},leiria:{posicao:7,negocios:8,visitar:31,viver:2}};